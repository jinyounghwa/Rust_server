# health_check.rs íŒŒì¼ ì„¤ëª… (ì´ˆê¸‰ ê°œë°œììš©)

## ğŸ“š ì´ íŒŒì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?

`health_check.rs`ëŠ” **í†µí•© í…ŒìŠ¤íŠ¸(Integration Test)** íŒŒì¼ì…ë‹ˆë‹¤.
ìš°ë¦¬ê°€ ë§Œë“  ì›¹ ì„œë²„ê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ ìë™ìœ¼ë¡œ í™•ì¸í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

## ğŸ¯ ì™œ í•„ìš”í•œê°€ìš”?

ì›¹ ì„œë²„ë¥¼ ë§Œë“¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì§ˆë¬¸ë“¤ì´ ìƒê¹ë‹ˆë‹¤:
- "ì„œë²„ê°€ ì •ë§ ì‹œì‘ë˜ë‚˜ìš”?"
- "API ìš”ì²­ì„ ë³´ë‚´ë©´ ì˜¬ë°”ë¥¸ ì‘ë‹µì´ ì˜¤ë‚˜ìš”?"
- "ë‚´ê°€ ì½”ë“œë¥¼ ìˆ˜ì •í–ˆì„ ë•Œ ê¸°ì¡´ ê¸°ëŠ¥ì´ ë§ê°€ì§€ì§€ ì•Šì•˜ë‚˜ìš”?"

ì´ëŸ° ì§ˆë¬¸ë“¤ì— ë‹µí•˜ê¸° ìœ„í•´ **ìë™ í…ŒìŠ¤íŠ¸**ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

## ğŸ“– ì½”ë“œ ìƒì„¸ ì„¤ëª…

### 1. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°

```rust
use std::net::TcpListener;
use zero2prod::startup;
```

- `TcpListener`: ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ ë°›ëŠ” ë„êµ¬ (ì „í™”ê¸°ì˜ ìˆ˜í™”ê¸° ê°™ì€ ì—­í• )
- `zero2prod::startup`: ìš°ë¦¬ê°€ ë§Œë“  ì„œë²„ë¥¼ ì‹œì‘í•˜ëŠ” í•¨ìˆ˜

---

### 2. `spawn_app()` í•¨ìˆ˜ - í…ŒìŠ¤íŠ¸ìš© ì„œë²„ ì‹œì‘í•˜ê¸°

```rust
fn spawn_app() -> String {
    let listener = TcpListener::bind("127.0.0.1:0")
        .expect("Failed to bind random port");
    let port = listener.local_addr().unwrap().port();
    let server = startup(listener)
        .expect("Failed to create server");

    let _ = tokio::spawn(async move {
        let _ = server.await;
    });

    format!("http://127.0.0.1:{}", port)
}
```

#### ğŸ” ë‹¨ê³„ë³„ ì„¤ëª…

1. **`TcpListener::bind("127.0.0.1:0")`**
   - `127.0.0.1`: ë¡œì»¬í˜¸ìŠ¤íŠ¸ (ë‚´ ì»´í“¨í„°)
   - `:0`: ìš´ì˜ì²´ì œì•¼, ì‚¬ìš© ê°€ëŠ¥í•œ í¬íŠ¸ ì•„ë¬´ê±°ë‚˜ ê³¨ë¼ì¤˜!
   - ì™œ 0ì„ ì“¸ê¹Œ? â†’ í…ŒìŠ¤íŠ¸ë¥¼ ì—¬ëŸ¬ ê°œ ë™ì‹œì— ì‹¤í–‰í•´ë„ í¬íŠ¸ ì¶©ëŒì´ ì—†ë„ë¡

2. **`let port = listener.local_addr().unwrap().port();`**
   - ìš´ì˜ì²´ì œê°€ í• ë‹¹í•´ì¤€ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ê°€ì ¸ì˜´
   - ì˜ˆ: 8080, 3000 ê°™ì€ ìˆ«ì

3. **`let server = startup(listener)`**
   - ì‹¤ì œ ì„œë²„ë¥¼ ìƒì„±

4. **`tokio::spawn(async move { ... })`**
   - ì„œë²„ë¥¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰
   - ë¹„ìœ : ìŒì•…ì„ ì¬ìƒí•˜ê³  ë‹¤ë¥¸ ì‘ì—…ì„ ê³„ì†í•˜ëŠ” ê²ƒì²˜ëŸ¼

5. **`format!("http://127.0.0.1:{}", port)`**
   - ì„œë²„ ì£¼ì†Œë¥¼ ë¬¸ìì—´ë¡œ ë°˜í™˜
   - ì˜ˆ: "http://127.0.0.1:8080"

---

### 3. í…ŒìŠ¤íŠ¸ 1: `health_check_works()` - í—¬ìŠ¤ ì²´í¬ í…ŒìŠ¤íŠ¸

```rust
#[tokio::test]
async fn health_check_works() {
    let addr = spawn_app();

    let response = reqwest::Client::new()
        .get(&format!("{}/health_check", addr))
        .send()
        .await
        .expect("Failed to execute request");

    assert!(response.status().is_success());
    assert_eq!(response.text().await.unwrap(), "OK");
}
```

#### ğŸ” ë¬´ìŠ¨ ì¼ì„ í•˜ë‚˜ìš”?

1. **`let addr = spawn_app();`**
   - í…ŒìŠ¤íŠ¸ìš© ì„œë²„ ì‹œì‘

2. **`reqwest::Client::new().get(...)`**
   - HTTP GET ìš”ì²­ ë³´ë‚´ê¸°
   - ë¸Œë¼ìš°ì €ì—ì„œ ì£¼ì†Œì°½ì— URL ì…ë ¥í•˜ëŠ” ê²ƒê³¼ ê°™ìŒ
   - ìš”ì²­ ì£¼ì†Œ: `http://127.0.0.1:í¬íŠ¸ë²ˆí˜¸/health_check`

3. **`assert!(response.status().is_success());`**
   - ì‘ë‹µ ìƒíƒœ ì½”ë“œê°€ ì„±ê³µ(200)ì¸ì§€ í™•ì¸
   - HTTP ìƒíƒœ ì½”ë“œë€?
     - 200: ì„±ê³µ
     - 404: í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
     - 500: ì„œë²„ ì—ëŸ¬

4. **`assert_eq!(response.text().await.unwrap(), "OK");`**
   - ì‘ë‹µ ë³¸ë¬¸ì´ ì •í™•íˆ "OK"ì¸ì§€ í™•ì¸

#### âœ… ì´ í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí•˜ë©´?

ì„œë²„ê°€ ì œëŒ€ë¡œ ì‹œì‘ë˜ê³ , `/health_check` ì—”ë“œí¬ì¸íŠ¸ê°€ "OK"ë¥¼ ë°˜í™˜í•œë‹¤ëŠ” ê²ƒì„ í™•ì¸!

---

### 4. í…ŒìŠ¤íŠ¸ 2: `greet_returns_name()` - ì´ë¦„ìœ¼ë¡œ ì¸ì‚¬í•˜ê¸°

```rust
#[tokio::test]
async fn greet_returns_name() {
    let addr = spawn_app();

    let response = reqwest::Client::new()
        .get(&format!("{}/Alice", addr))
        .send()
        .await
        .expect("Failed to execute request");

    assert!(response.status().is_success());
    assert_eq!(response.text().await.unwrap(), "Hello Alice!");
}
```

#### ğŸ” ë¬´ìŠ¨ ì¼ì„ í•˜ë‚˜ìš”?

- `/Alice` ì£¼ì†Œë¡œ ìš”ì²­ì„ ë³´ëƒ„
- ì„œë²„ê°€ "Hello Alice!"ë¥¼ ì‘ë‹µí•˜ëŠ”ì§€ í™•ì¸
- ë‹¤ë¥¸ ì´ë¦„ì„ ë„£ìœ¼ë©´? â†’ "Hello [ì´ë¦„]!"ì´ ë°˜í™˜ë˜ì–´ì•¼ í•¨

---

### 5. í…ŒìŠ¤íŠ¸ 3: `greet_default_world()` - ê¸°ë³¸ ì¸ì‚¬

```rust
#[tokio::test]
async fn greet_default_world() {
    let addr = spawn_app();

    let response = reqwest::Client::new()
        .get(&addr)
        .send()
        .await
        .expect("Failed to execute request");

    assert!(response.status().is_success());
    assert_eq!(response.text().await.unwrap(), "Hello World!");
}
```

#### ğŸ” ë¬´ìŠ¨ ì¼ì„ í•˜ë‚˜ìš”?

- ë£¨íŠ¸ ê²½ë¡œ(`/`)ë¡œ ìš”ì²­ì„ ë³´ëƒ„
- ì„œë²„ê°€ "Hello World!"ë¥¼ ì‘ë‹µí•˜ëŠ”ì§€ í™•ì¸
- ì´ë¦„ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ "World"ë¥¼ ì‚¬ìš©

---

## ğŸš€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ê¸°

í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰:

```bash
cargo test
```

ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ë©´ âœ… í‘œì‹œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤!

---

## ğŸ’¡ í•µì‹¬ ê°œë… ì •ë¦¬

### 1. **í†µí•© í…ŒìŠ¤íŠ¸ (Integration Test)**
- ì—¬ëŸ¬ ë¶€ë¶„ì´ í•¨ê»˜ ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸
- ì‹¤ì œ ì„œë²„ë¥¼ ì‹œì‘í•˜ê³  HTTP ìš”ì²­ì„ ë³´ë‚´ì„œ í…ŒìŠ¤íŠ¸

### 2. **`#[tokio::test]` ì†ì„±**
- ë¹„ë™ê¸° í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ
- `async/await`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

### 3. **`assert!` ë§¤í¬ë¡œ**
- `assert!(ì¡°ê±´)`: ì¡°ê±´ì´ ì°¸ì¸ì§€ í™•ì¸
- `assert_eq!(a, b)`: aì™€ bê°€ ê°™ì€ì§€ í™•ì¸
- ì‹¤íŒ¨í•˜ë©´ í…ŒìŠ¤íŠ¸ê°€ ì¤‘ë‹¨ë˜ê³  ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥

### 4. **ì™œ í¬íŠ¸ë¥¼ 0ìœ¼ë¡œ ë°”ì¸ë”©í•˜ë‚˜ìš”?**
- ìš´ì˜ì²´ì œê°€ ìë™ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ í¬íŠ¸ë¥¼ í• ë‹¹
- ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ ë™ì‹œì— ì‹¤í–‰í•´ë„ ì¶©ëŒ ì—†ìŒ

---

## ğŸ“ ì´ˆê¸‰ ê°œë°œìë¥¼ ìœ„í•œ íŒ

1. **í…ŒìŠ¤íŠ¸ëŠ” ë¬¸ì„œì…ë‹ˆë‹¤**
   - ì´ ì½”ë“œë¥¼ ë³´ë©´ ì„œë²„ê°€ ì–´ë–»ê²Œ ë™ì‘í•´ì•¼ í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆì–´ìš”

2. **ì‘ì€ ë³€ê²½ í›„ í•­ìƒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰**
   ```bash
   cargo test
   ```

3. **í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•˜ë©´?**
   - ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ê¼¼ê¼¼íˆ ì½ì–´ë³´ì„¸ìš”
   - ì–´ë–¤ assertê°€ ì‹¤íŒ¨í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”
   - ì˜ˆìƒê°’ê³¼ ì‹¤ì œê°’ì„ ë¹„êµí•˜ì„¸ìš”

4. **ìƒˆ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë©´?**
   - ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ë„ í•¨ê»˜ ì‘ì„±í•˜ì„¸ìš”
   - ì˜ˆ: `/goodbye` ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•˜ë©´ `test_goodbye()` ì‘ì„±

---

## ğŸ“š ë” ê³µë¶€í•˜ê¸°

- **Rust ê³µì‹ ë¬¸ì„œ**: https://doc.rust-lang.org/book/ch11-00-testing.html
- **Tokio ë¬¸ì„œ**: https://tokio.rs/
- **Reqwest ë¬¸ì„œ**: https://docs.rs/reqwest/

---

## â“ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

**Q: ì™œ `unwrap()`ì„ ì‚¬ìš©í•˜ë‚˜ìš”?**
- í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œëŠ” ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì¦‰ì‹œ íŒ¨ë‹‰(panic)í•´ë„ ê´œì°®ì•„ìš”
- ì‹¤ì œ í”„ë¡œë•ì…˜ ì½”ë“œì—ì„œëŠ” `unwrap()` ëŒ€ì‹  ì ì ˆí•œ ì—ëŸ¬ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤

**Q: `async/await`ê°€ ë­”ê°€ìš”?**
- ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°: ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ë‹¤ë¥¸ ì‘ì—…ì„ í•  ìˆ˜ ìˆìŒ
- `await`: ì´ ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ ì¤˜

**Q: í…ŒìŠ¤íŠ¸ê°€ ë„ˆë¬´ ëŠë ¤ìš”**
- í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ì‹¤ì œ ì„œë²„ë¥¼ ì‹œì‘í•˜ë¯€ë¡œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë³´ë‹¤ ëŠë¦½ë‹ˆë‹¤
- ë¹ ë¥¸ í”¼ë“œë°±ì´ í•„ìš”í•˜ë©´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ë” ë§ì´ ì‘ì„±í•˜ì„¸ìš”

---

ì´ ë¬¸ì„œê°€ ë„ì›€ì´ ë˜ì—ˆê¸°ë¥¼ ë°”ëë‹ˆë‹¤! ğŸ‰
